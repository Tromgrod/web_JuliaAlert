@model MovingProduct
@using Weblib.Models.Common
@using JuliaAlert.Models.Objects
@using Weblib.Models.Common.Enums
@using LIB.BusinessObjects
@using LIB.AdvancedProperties
@using LIB.Tools.BO

@{
    ViewBag.Title = "Перемещение моделей";
    Layout = "~/Views/Master/_Standard_NoFooter.cshtml";

    var currentUser = LIB.Tools.Security.Authentication.GetCurrentUser();

    bool FactoryPriceVisible = currentUser.HasAtLeastOnePermission((long)BasePermissionenum.FactoryPrice);
    bool ProductionAccess = currentUser.HasAtLeastOnePermission((long)BasePermissionenum.Production);

    var documentNumber = Model.Id > 0 ? Model.DocumentNumber : "";

    if (string.IsNullOrEmpty(documentNumber))
    {
        var lastMovingProduct = ItemBase.GetLast<MovingProduct>();

        int newDocumentNumber;

        if (int.TryParse(lastMovingProduct.DocumentNumber, out newDocumentNumber))
        {
            documentNumber = (++newDocumentNumber).ToString();
        }
    }
}

<script src="~/Scripts/FrontEnd/Object/product.js"></script>
<script src="~/Scripts/FrontEnd/Object/stock.js"></script>
<script src="~/Scripts/FrontEnd/Object/production.js"></script>
<script src="~/Scripts/FrontEnd/print.js"></script>
<script src="~/Scripts/FrontEnd/popup.js"></script>

<form class="inner-content-area content-control content-two-columns" action="@LIB.Tools.Utils.URLHelper.GetUrl("DocControl/Save")">
    @{
        @Html.Partial("../Controls/RowControl/_pagecontrols", new PageControlsModel()
        {
            Id = Model.Id,
            Buttons = new List<ButtonModel>(),
            Object = "MovingProduct",
            Delete = Model.Id > 0,
            Save = true,
            Namespace = typeof(MovingProduct).FullName
        })
    }
    @Html.AntiForgeryToken()
    @Html.ValidationSummary(true)
    <div class="content-one-column">
        <div class="edit-section">
            <div class="edit-section-header">Перемещение моделей</div>

            <div class="edit-section-body">

                <div class="edit-section-row">
                    <div class="edit-section-row-trio edit-section-row-fisrt">
                        @Html.Partial("../Controls/RowControl/_inputrow", new TextboxModel()
                        {
                            Name = "DocumentNumber",
                            Type = TextboxType.Text,
                            Value = documentNumber,
                            Caption = "№ Документа",
                            ValidationType = ValidationTypes.Required
                        })
                    </div>
                    <div class="edit-section-row-trio edit-section-row-second">
                        @Html.Partial("../Controls/RowControl/_inputrow", new TextboxModel()
                        {
                            Name = "Date",
                            Class = "input calendar-input",
                            Type = Weblib.Models.Common.Enums.TextboxType.Date,
                            Value = Model.Date != DateTime.MinValue ? Model.Date.ToString(@"dd/MM/yyyy", System.Globalization.CultureInfo.InvariantCulture) : "",
                            DateValue = Model.Date != DateTime.MinValue ? Model.Date : DateTime.MinValue,
                            ValidationType = ValidationTypes.Required,
                            Caption = "Дата документа"
                        })
                    </div>
                    <div class="edit-section-row-trio edit-section-row-third">
                        @Html.Partial("../Controls/RowControl/_inputrow", new TextboxModel()
                         {
                             Name = "Description",
                             Type = Weblib.Models.Common.Enums.TextboxType.MultiLine,
                             Value = Model.Description,
                             Caption = "Комментарий к приходу"
                         })
                    </div>
                </div>

            </div>
        </div>
    </div>

    @if (Model.Id > 0)
    {
        <div class="clear separator"></div>

        <div id="supply_product_unit_dynamic" class="edit-section dynamic-section dynamic-section-sample">
            <div class="edit-section-header">
                <div style="display: flex;">
                    <div id="dynamic_section_samples" onclick="toggle_dynamic_section(this,'@typeof(MovingProductUnit).FullName')" title="Добавить модель" class="edit-section-state-indicator">
                        <div class="close-block right-line"></div>
                        <div class="close-block left-line"></div>
                    </div>
                    <div id="header-caption-price" class="edit-section-header-caption">Модели</div>
                </div>
                <div class="edit-section-icons-group">
                    <a id="btn_open_dynamic" onclick="add_new_dynamic_section(this,'@typeof(MovingProductUnit).FullName')" title="Добавить модель" class="edit-section-icon edit-section-new"></a>
                </div>
            </div>
            <div class="edit-section-body edit-section-body-samples"></div>
        </div>
    }

</form>