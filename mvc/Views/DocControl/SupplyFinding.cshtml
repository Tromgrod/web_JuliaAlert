@model SupplyFinding
@using Weblib.Models.Common
@using JuliaAlert.Models.Objects
@using LIB.AdvancedProperties
@using Weblib.Models.Common.Enums
@using LIB.Tools.BO

@{
    ViewBag.Title = Model.Id > 0 ? "Приход фурнитуры: " + Model.GetName() : "Добавить приход фурнитуры";
    Layout = "~/Views/Master/_Standard_NoFooter.cshtml";

    var documentNumber = Model.Id > 0 ? Model.DocumentNumber : "";

    if (string.IsNullOrEmpty(documentNumber))
    {
        var lastSupplyFinding = ItemBase.GetLast<SupplyFinding>();

        int newDocumentNumber;

        if (int.TryParse(lastSupplyFinding.DocumentNumber, out newDocumentNumber))
        {
            documentNumber = (++newDocumentNumber).ToString();
        }
    }
}

<script src="~/Scripts/FrontEnd/Object/production.js"></script>
<script src="~/Scripts/FrontEnd/popup.js"></script>

<form class="inner-content-area content-control content-two-columns" action="@LIB.Tools.Utils.URLHelper.GetUrl("DocControl/Save")">
    @{
        List<ButtonModel> ControlButtons = new List<ButtonModel>();
        @Html.Partial("../Controls/RowControl/_pagecontrols", new PageControlsModel()
        {
            Id = Model.Id,
            Buttons = ControlButtons,
            Object = "SupplyFinding",
            Delete = true,
            Save = true,
            Namespace = typeof(SupplyFinding).FullName
        })
    }
    @Html.AntiForgeryToken()
    @Html.ValidationSummary(true)
    <div class="content-one-column">
        <div class="edit-section">
            <div class="edit-section-header">Приход фурнитуры</div>

            <div class="edit-section-body">

                <div class="edit-section-row">
                    <div class="edit-section-row-quad">
                        @Html.Partial("../Controls/RowControl/_inputrow", new TextboxModel()
                        {
                            Name = "DocumentNumber",
                            Type = TextboxType.Text,
                            Value = documentNumber,
                            Caption = "№ Документа",
                            ValidationType = ValidationTypes.Required
                        })
                    </div>
                    <div class="edit-section-row-quad">
                        @Html.Partial("../Controls/RowControl/_inputrow", new TextboxModel()
                        {
                            Name = "Date",
                            Class = "input calendar-input",
                            Type = Weblib.Models.Common.Enums.TextboxType.Date,
                            Value = Model.Date != DateTime.MinValue ? Model.Date.ToString(@"dd/MM/yyyy", System.Globalization.CultureInfo.InvariantCulture) : "",
                            DateValue = Model.Date != DateTime.MinValue ? Model.Date : DateTime.MinValue,
                            ValidationType = ValidationTypes.Required,
                            Caption = "Дата документа"
                        })
                    </div>
                    <div class="edit-section-row-quad">
                        @Html.Partial("../Controls/RowControl/_selectrow", new DropDownModel()
                   {
                       Name = "LocationStorage",
                       AllowDefault = Model.Id <= 0,
                       Value = Model.Id > 0 ? Model.LocationStorage.Id.ToString() : "0",
                       Options = Model.Id > 0 ? new Dictionary<long, LIB.Tools.BO.ItemBase> { { Model.LocationStorage.Id, Model.LocationStorage } } : new LocationStorage().Populate(),
                       Caption = "Склад",
                       ValidationType = ValidationTypes.Required
                   })
                    </div>
                    <div class="edit-section-row-quad">
                        @Html.Partial("../Controls/RowControl/_selectrow", new DropDownModel()
                        {
                            Name = "Provider",
                            AllowDefault = true,
                            Value = Model.Id > 0 ? Model.Provider.Id.ToString() : "0",
                            Options = new Provider().Populate(),
                            Caption = "Поставщик",
                            ValidationType = ValidationTypes.Required
                        })
                    </div>
                </div>

                <div class="edit-section-row">
                    <div class="full-size">
                        @Html.Partial("../Controls/RowControl/_inputrow", new TextboxModel()
                        {
                            Name = "Description",
                            Type = Weblib.Models.Common.Enums.TextboxType.MultiLine,
                            Value = Model.Description,
                            Caption = "Комментарий к приходу"
                        })
                    </div>
                </div>

            </div>
        </div>
    </div>

    @if (Model.Id > 0)
    {
        <div class="clear separator"></div>

        <div id="supply_finding_unit_dynamic" class="edit-section dynamic-section dynamic-section-sample">
            <div class="edit-section-header">
                <div style="display: flex;">
                    <div id="dynamic_section_samples" onclick="toggle_dynamic_section(this,'@typeof(SupplyFindingUnit).FullName')" title="Добавить фурнитуру" class="edit-section-state-indicator">
                        <div class="close-block right-line"></div>
                        <div class="close-block left-line"></div>
                    </div>
                    <div id="header-caption-price" class="edit-section-header-caption">Фурнитура</div>
                </div>
                <div class="edit-section-icons-group">
                    <a id="btn_open_dynamic" onclick="add_new_dynamic_section(this,'@typeof(SupplyFindingUnit).FullName')" title="Добавить фурнитуру" class="edit-section-icon edit-section-new"></a>
                    <a id="add_FindingColor" onclick="open_simple_popup_noData('~/Views/Production/AddNewFinding.cshtml')" title="Добавить новую фурнитуру" class="edit-section-icon edit-section-new-finding"></a>
                </div>
            </div>
            <div class="edit-section-body edit-section-body-samples"></div>
        </div>
    }

</form>